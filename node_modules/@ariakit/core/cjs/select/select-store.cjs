"use strict";Object.defineProperty(exports, "__esModule", {value: true});"use client";


var _PW36G76Lcjs = require('../__chunks/PW36G76L.cjs');
require('../__chunks/CCI5VM7E.cjs');


var _ULSPM3Y3cjs = require('../__chunks/ULSPM3Y3.cjs');


var _H6ZQSQQLcjs = require('../__chunks/H6ZQSQQL.cjs');
require('../__chunks/N667HVED.cjs');
require('../__chunks/QLWAGBAQ.cjs');








var _3QF3ODTRcjs = require('../__chunks/3QF3ODTR.cjs');


var _BTUHABP4cjs = require('../__chunks/BTUHABP4.cjs');
require('../__chunks/7WYII4AN.cjs');




var _3IVNQNIVcjs = require('../__chunks/3IVNQNIV.cjs');

// src/select/select-store.ts
function createSelectStore(_a = {}) {
  var _b = _a, {
    combobox
  } = _b, props = _3IVNQNIVcjs.__objRest.call(void 0, _b, [
    "combobox"
  ]);
  const store = _3QF3ODTRcjs.mergeStore.call(void 0, 
    props.store,
    _3QF3ODTRcjs.omit.call(void 0, combobox, [
      "value",
      "items",
      "renderedItems",
      "baseElement",
      "arrowElement",
      "anchorElement",
      "contentElement",
      "popoverElement",
      "disclosureElement"
    ])
  );
  _3QF3ODTRcjs.throwOnConflictingProps.call(void 0, props, store);
  const syncState = store.getState();
  const composite = _PW36G76Lcjs.createCompositeStore.call(void 0, _3IVNQNIVcjs.__spreadProps.call(void 0, _3IVNQNIVcjs.__spreadValues.call(void 0, {}, props), {
    store,
    virtualFocus: _BTUHABP4cjs.defaultValue.call(void 0, 
      props.virtualFocus,
      syncState.virtualFocus,
      true
    ),
    includesBaseElement: _BTUHABP4cjs.defaultValue.call(void 0, 
      props.includesBaseElement,
      syncState.includesBaseElement,
      false
    ),
    activeId: _BTUHABP4cjs.defaultValue.call(void 0, 
      props.activeId,
      syncState.activeId,
      props.defaultActiveId,
      null
    ),
    orientation: _BTUHABP4cjs.defaultValue.call(void 0, 
      props.orientation,
      syncState.orientation,
      "vertical"
    )
  }));
  const popover = _H6ZQSQQLcjs.createPopoverStore.call(void 0, _3IVNQNIVcjs.__spreadProps.call(void 0, _3IVNQNIVcjs.__spreadValues.call(void 0, {}, props), {
    store,
    placement: _BTUHABP4cjs.defaultValue.call(void 0, 
      props.placement,
      syncState.placement,
      "bottom-start"
    )
  }));
  const initialValue = new String("");
  const initialState = _3IVNQNIVcjs.__spreadProps.call(void 0, _3IVNQNIVcjs.__spreadValues.call(void 0, _3IVNQNIVcjs.__spreadValues.call(void 0, {}, composite.getState()), popover.getState()), {
    value: _BTUHABP4cjs.defaultValue.call(void 0, 
      props.value,
      syncState.value,
      props.defaultValue,
      initialValue
    ),
    setValueOnMove: _BTUHABP4cjs.defaultValue.call(void 0, 
      props.setValueOnMove,
      syncState.setValueOnMove,
      false
    ),
    labelElement: _BTUHABP4cjs.defaultValue.call(void 0, syncState.labelElement, null),
    selectElement: _BTUHABP4cjs.defaultValue.call(void 0, syncState.selectElement, null),
    listElement: _BTUHABP4cjs.defaultValue.call(void 0, syncState.listElement, null)
  });
  const select = _3QF3ODTRcjs.createStore.call(void 0, initialState, composite, popover, store);
  _3QF3ODTRcjs.setup.call(void 0, 
    select,
    () => _3QF3ODTRcjs.sync.call(void 0, select, ["value", "items"], (state) => {
      if (state.value !== initialValue) return;
      if (!state.items.length) return;
      const item = state.items.find(
        (item2) => !item2.disabled && item2.value != null
      );
      if ((item == null ? void 0 : item.value) == null) return;
      select.setState("value", item.value);
    })
  );
  _3QF3ODTRcjs.setup.call(void 0, 
    select,
    () => _3QF3ODTRcjs.sync.call(void 0, select, ["mounted"], (state) => {
      if (state.mounted) return;
      select.setState("activeId", initialState.activeId);
    })
  );
  _3QF3ODTRcjs.setup.call(void 0, 
    select,
    () => _3QF3ODTRcjs.sync.call(void 0, select, ["mounted", "items", "value"], (state) => {
      if (combobox) return;
      if (state.mounted) return;
      const values = _ULSPM3Y3cjs.toArray.call(void 0, state.value);
      const lastValue = values[values.length - 1];
      if (lastValue == null) return;
      const item = state.items.find(
        (item2) => !item2.disabled && item2.value === lastValue
      );
      if (!item) return;
      select.setState("activeId", item.id);
    })
  );
  _3QF3ODTRcjs.setup.call(void 0, 
    select,
    () => _3QF3ODTRcjs.batch.call(void 0, select, ["setValueOnMove", "moves"], (state) => {
      const { mounted, value, activeId } = select.getState();
      if (!state.setValueOnMove && mounted) return;
      if (Array.isArray(value)) return;
      if (!state.moves) return;
      if (!activeId) return;
      const item = composite.item(activeId);
      if (!item || item.disabled || item.value == null) return;
      select.setState("value", item.value);
    })
  );
  return _3IVNQNIVcjs.__spreadProps.call(void 0, _3IVNQNIVcjs.__spreadValues.call(void 0, _3IVNQNIVcjs.__spreadValues.call(void 0, _3IVNQNIVcjs.__spreadValues.call(void 0, {}, composite), popover), select), {
    combobox,
    setValue: (value) => select.setState("value", value),
    setLabelElement: (element) => select.setState("labelElement", element),
    setSelectElement: (element) => select.setState("selectElement", element),
    setListElement: (element) => select.setState("listElement", element)
  });
}


exports.createSelectStore = createSelectStore;
